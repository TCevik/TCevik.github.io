<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TC_tam Picto Planner</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/script.js"></script>

    <style>
        #planner-container {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #planner-container.fade-in {
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .setup-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            width: 80%;
            height: 80%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--bg-accent-color2), var(--bg-accent-color1));
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 5;
            opacity: 0;
            border-radius: var(--border-radius2);
            transition: opacity 0.5s ease;
            overflow-y: auto;
        }

        .settings-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            width: 80%;
            height: 80%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--bg-accent-color2), var(--bg-accent-color1));
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 5;
            opacity: 0;
            border-radius: var(--border-radius2);
            transition: opacity 0.5s ease;
            text-align: left;
            align-content: left;
            justify-content: left;
            overflow-y: auto;
        }

        .setup-menu.fade-in {
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .settings-menu.fade-in {
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .setup-menu button {
            flex: 1;
            height: 100%;
        }

        #setupButtons {
            display: flex;
        }

        .no-arrows::-webkit-inner-spin-button,
        .no-arrows::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        #planner-content {
            background: linear-gradient(135deg, var(--bg-accent-color2), var(--bg-accent-color1));
            border-radius: var(--border-radius2);
            padding: 15px;
            margin: 25px;
        }

        .picto {
            width: 125px;
            height: 125px;
            border: 1px var(--text-color) solid;
            padding: 5px;
            margin-left: 5px;
            margin-right: 5px;
            user-select: none;
        }

        #pictos {
            display: none;
            align-content: left;
            text-align: left;
            justify-content: left;
            margin-left: 20px;
        }

        .settings-menu input {
            margin-left: 0px;
            margin-top: 5px;
            margin-right: 5px;
        }

        #done-editing-button {
            display: none;
        }

        @media (orientation: portrait) {
            .setup-menu {
                width: 85%;
                height: 93%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            .setup-menu button {
                display: block;
                margin: 10px 0;
                width: 100%;
            }

            .settings-menu {
                width: 85%;
                height: 93%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            #setupButtons {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }
        }

        .uploaded-picto {
            position: relative;
            display: inline-block;
        }

        .remove-picto {
            position: absolute;
            top: 10px;
            right: 10px;
            transform: translate(-50%, -50%);
            color: red;
            cursor: pointer;
            font-size: 20px;
            z-index: 1;
        }
    </style>
</head>

<body>
    <div id="setup-menu" class="setup-menu">
        <h2>Laten we de planner instellen.</h2>
        <div id="pinOrNot">
            <h4>Wil je een pincode instellen?</h4>
            <p style="margin: 5px;">Een pincode zorgt ervoor dat je kind de planning niet zomaar kan veranderen.</p>
            <div id="setupButtons">
                <button onclick="createPin()">Ja, stel een code in!</button>
                <button onclick="setupCompleted()">Nee, ga verder zonder code!</button>
            </div>
        </div>

        <div id="pinSetup" style="display:none;">
            <h4>Voer een pincode in:</h4>
            <input autocomplete="off" type="text" id="pincode" placeholder="Pincode" maxlength="6"
                oninput="this.value = this.value.replace(/[^0-9]/g, '');" class="no-arrows">
            <button id="setPinButton" onclick="setPin()">Pincode instellen</button>
        </div>
    </div>

    <div id="settings-menu" class="settings-menu">
        <button onclick="closeSettings()">Sluiten</button>
        <div id="makePinButtonContainer">
            <input autocomplete="off" type="text" id="pincodeCreate" placeholder="Pincode" maxlength="6"
                oninput="this.value = this.value.replace(/[^0-9]/g, '');" class="no-arrows">
            <button id="makePinButton" onclick="makePin()">Maak pincode</button>
        </div>

        <div id="pinChange" style="display: none;">
            <h4>Voer een nieuwe pincode in:</h4>
            <input autocomplete="off" type="text" id="pincodeChangeVerify" placeholder="Oude pincode" maxlength="6"
                oninput="this.value = this.value.replace(/[^0-9]/g, '');" class="no-arrows">
            <input autocomplete="off" type="text" id="pincodeChange" placeholder="Pincode" maxlength="6"
                oninput="this.value = this.value.replace(/[^0-9]/g, '');" class="no-arrows">
            <button id="changePinButton" onclick="changePin()">Pincode veranderen</button>
        </div>

        <div id="deletePin" style="display: none;">
            <h4>Voer je pincode in om deze uit te schakelen:</h4>
            <input autocomplete="off" type="text" id="deleteVerify" placeholder="Pincode" maxlength="6"
                oninput="this.value = this.value.replace(/[^0-9]/g, '');" class="no-arrows">
            <button id="deletePinButton" onclick="deletePin()">Pincode uitschakelen</button>
        </div>

        <div id="forgotPin" style="display: none;">
            <h4>Pincode vergeten:</h4>
            <input autocomplete="off" type="text" id="deleteVerifyAdult" placeholder="SOM" maxlength="3"
                oninput="this.value = this.value.replace(/[^0-9]/g, '');" class="no-arrows">
            <input autocomplete="off" type="text" id="forgotPinInput" placeholder="Pincode" maxlength="6"
                oninput="this.value = this.value.replace(/[^0-9]/g, '');" class="no-arrows">
            <button onclick="forgotPin()" id="forgotPin">Pincode vergeten</button>
        </div>

        <div>
            <h4>Verwijder alle picto's</h4>
            <div style="display: flex;">
                <input autocomplete="off" type="text" id="deletePictosVerify" placeholder="Pincode" maxlength="6"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '');" class="no-arrows">
                <button id="deletePictosButton" onclick="deletePictos()"
                    style="height: 50px; background-color: red; color: white;">Verwijder picto's</button>
            </div>
        </div>
    </div>

    <div id="planner-container" style="display: none;">
        <h1 id="title" style="margin-bottom: -10px;">TC_tam Picto Planner</h1>

        <div id="planner-content"></div>

        <div id="pictos">
            <input type="file" id="upload-picto-input" accept="image/*" />
            <img title="TC_tam" class="picto" src="/favicon.ico">
            <img title="Google" class="picto" src="https://google.com/favicon.ico">
        </div>

        <button id="settings-button" style="position: fixed; top: 5px; left: 5px;"
            onclick="openSettings()">Instellingen</button>
        <button id="edit-button" style="position: fixed; top: 5px; right: 5px;" onclick="editPlanner()">Planner
            aanpassen</button>
        <button id="done-editing-button" style="position: fixed; top: 5px; right: 5px;"
            onclick="doneEditingPlanner()">Klaar</button>
    </div>

    <script>
        function loadPlanner() {
            const plannerContainer = document.getElementById('planner-container');
            const plannerContentElement = document.getElementById('planner-content');
            plannerContainer.style.display = 'block';
            setTimeout(() => {
                plannerContainer.classList.add('fade-in');
            }, 10);
            initAddingPictos();
            loadPictosFromLocalStorage();
            loadUploadedPictos();
            initUploadPicto();
        }

        function initAddingPictos() {
            const pictos = document.querySelectorAll('#pictos .picto');

            pictos.forEach(picto => {
                picto.addEventListener('click', () => {
                    const title = picto.getAttribute('title');
                    const pictosArray = JSON.parse(localStorage.getItem('pictos')) || [];
                    const index = pictosArray.length;
                    pictosArray.push({ index, title, src: picto.src });
                    localStorage.setItem('pictos', JSON.stringify(pictosArray));

                    addPictoToPlanner({ index, title, src: picto.src });
                });
            });
        }

        function loadPictosFromLocalStorage() {
            const plannerContentElement = document.getElementById('planner-content');
            plannerContentElement.innerHTML = '';

            const pictosArray = JSON.parse(localStorage.getItem('pictos')) || [];
            pictosArray.sort((a, b) => a.index - b.index);

            pictosArray.forEach(picto => {
                addPictoToPlanner(picto);
            });
        }

        function loadUploadedPictos() {
            const pictosArray = JSON.parse(localStorage.getItem('uploadedPictos')) || [];

            pictosArray.forEach(picto => {
                addPictoToPictos(picto);
            });
        }

        function addPictoToPlanner({ index, title, src }) {
            const plannerContentElement = document.getElementById('planner-content');

            const newPicto = document.createElement('img');
            newPicto.src = src;
            newPicto.title = title;
            newPicto.className = 'picto';

            newPicto.addEventListener('click', () => {
                removePictoFromPlanner(index);
            });

            plannerContentElement.appendChild(newPicto);
        }

        function removePictoFromPlanner(index) {
            const pictosArray = JSON.parse(localStorage.getItem('pictos')) || [];
            const updatedPictosArray = pictosArray.filter(picto => picto.index !== index);

            updatedPictosArray.forEach((picto, newIndex) => {
                picto.index = newIndex;
            });

            localStorage.setItem('pictos', JSON.stringify(updatedPictosArray));
            loadPictosFromLocalStorage();
        }

        function initUploadPicto() {
            const uploadInput = document.getElementById('upload-picto-input');
            uploadInput.addEventListener('change', handlePictoUpload);
        }

        function handlePictoUpload(event) {
            const file = event.target.files[0];
            const title = prompt('Geef een titel voor het pictogram:');

            if (file && title) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const uploadedPictos = JSON.parse(localStorage.getItem('uploadedPictos')) || [];
                    const index = uploadedPictos.length;
                    const newPicto = { index, title, src: e.target.result };

                    uploadedPictos.push(newPicto);
                    localStorage.setItem('uploadedPictos', JSON.stringify(uploadedPictos));

                    addPictoToPictos(newPicto);
                };
                reader.readAsDataURL(file);
            }
        }

        function addPictoToPictos({ title, src }) {
            const pictosElement = document.getElementById('pictos');
            const uploadedPicto = document.createElement('div');
            uploadedPicto.className = 'uploaded-picto';

            const pictoImage = document.createElement('img');
            pictoImage.src = src;
            pictoImage.title = title;
            pictoImage.className = 'picto';

            const removeButton = document.createElement('span');
            removeButton.innerText = 'x';
            removeButton.className = 'remove-picto';

            removeButton.addEventListener('click', (event) => {
                event.stopPropagation();
                removeUploadedPicto(uploadedPicto, { title, src });
            });

            uploadedPicto.appendChild(pictoImage);
            uploadedPicto.appendChild(removeButton);
            pictosElement.appendChild(uploadedPicto);

            uploadedPicto.addEventListener('click', () => {
                const pictosArray = JSON.parse(localStorage.getItem('pictos')) || [];
                const index = pictosArray.length;
                pictosArray.push({ index, title, src });
                localStorage.setItem('pictos', JSON.stringify(pictosArray));
                addPictoToPlanner({ index, title, src });
            });
        }

        function removeUploadedPicto(uploadedPicto, picto) {
            const uploadedPictos = JSON.parse(localStorage.getItem('uploadedPictos')) || [];
            const updatedUploadedPictos = uploadedPictos.filter(p => p.src !== picto.src);
            localStorage.setItem('uploadedPictos', JSON.stringify(updatedUploadedPictos));

            uploadedPicto.remove();
            loadUploadedPictos();
        }

        function editPlanner() {
            if (localStorage.getItem('pin')) {
                const pinEntered = prompt('Voer je pincode in om de planner te wijzigen.');
                if (pinEntered === localStorage.getItem('pin')) {
                    document.getElementById('pictos').style.display = "block";
                    document.getElementById('done-editing-button').style.display = "block";
                    document.getElementById('edit-button').style.display = "none";
                } else {
                    notification('Je pincode is niet correct.');
                }
            } else {
                document.getElementById('pictos').style.display = "block";
                document.getElementById('done-editing-button').style.display = "block";
                document.getElementById('edit-button').style.display = "none";
            }
        }

        function doneEditingPlanner() {
            document.getElementById('pictos').style.display = "none";
            document.getElementById('done-editing-button').style.display = "none";
            document.getElementById('edit-button').style.display = "block";
        }

        setInterval(() => {
            if (!localStorage.getItem('pin')) {
                editPlanner();
                document.getElementById('done-editing-button').style.display = "none";
                document.getElementById('edit-button').style.display = "none";
            }
        }, 10);

        /* SETTINGS SCRIPT */
        function openSettings() {
            const settingsMenu = document.getElementById('settings-menu');
            settingsMenu.style.display = 'block';

            document.getElementById('done-editing-button').click();
            document.getElementById('edit-button').style.display = "none";
            document.getElementById('settings-button').style.display = "none";

            setTimeout(() => {
                settingsMenu.classList.add('fade-in');
            }, 10);
        }

        function closeSettings() {
            const settingsMenu = document.getElementById('settings-menu');
            settingsMenu.classList.remove('fade-in');

            document.getElementById('done-editing-button').click();
            document.getElementById('edit-button').style.display = "block";
            document.getElementById('settings-button').style.display = "block";

            setTimeout(() => {
                settingsMenu.style.display = 'none';
            }, 500);
        }

        function updatePinVisibility() {
            const currentPin = localStorage.getItem('pin');
            const pinChange = document.getElementById('pinChange');
            const deletePin = document.getElementById('deletePin');
            const forgotPin = document.getElementById('forgotPin');
            const deletePictos = document.getElementById('deletePictosVerify');
            const makePinButtonContainer = document.getElementById('makePinButtonContainer');

            if (currentPin) {
                pinChange.style.display = 'block';
                deletePin.style.display = 'block';
                forgotPin.style.display = 'block';
                deletePictos.style.display = 'block';
                makePinButtonContainer.style.display = 'none';
            } else {
                pinChange.style.display = 'none';
                deletePin.style.display = 'none';
                forgotPin.style.display = 'none';
                deletePictos.style.display = 'none';
                makePinButtonContainer.style.display = 'block';
            }
        }

        function makePin() {
            const newPin = document.getElementById('pincodeCreate').value
            if (newPin && newPin.length <= 6) {
                localStorage.setItem('pin', newPin);
                notification("Pincode is ingesteld - " + newPin);
                updatePinVisibility();
                document.getElementById('pincodeCreate').value = '';
            } else {
                notification('De pincode moet maximaal 6 cijfers bevatten.');
            }
        }

        function changePin() {
            const pinChange = document.getElementById('pincodeChange').value;
            const pinEnteredToVerify = document.getElementById('pincodeChangeVerify').value;

            const currentPin = localStorage.getItem('pin');

            if (pinEnteredToVerify === currentPin) {
                if (pinChange.length <= 6) {
                    localStorage.setItem('pin', pinChange);
                    notification("Pincode is veranderd - " + pinChange);
                    document.getElementById('pincodeChange').value = '';
                    document.getElementById('pincodeChangeVerify').value = '';
                } else {
                    notification('De nieuwe pincode moet maximaal 6 cijfers bevatten.');
                }
            } else {
                notification('Dat is niet je pincode. Probeer het opnieuw.');
            }
        }

        function deletePin() {
            const pinEnteredToVerify = document.getElementById('deleteVerify').value;

            const currentPin = localStorage.getItem('pin');

            if (pinEnteredToVerify === currentPin) {
                localStorage.removeItem('pin');
                notification("Pincode is uitgeschakeld.");
                updatePinVisibility();
                document.getElementById('deleteVerify').value = '';
            } else {
                notification('Dat is niet je pincode. Probeer het opnieuw.');
            }
        }


        let num1 = Math.floor(Math.random() * 7) + 4;
        let num2 = Math.floor(Math.random() * 7) + 4;
        let correctAnswer = num1 * num2;

        document.getElementById('deleteVerifyAdult').placeholder = `${num1} x ${num2} = ?`;

        function forgotPin() {
            const userAnswer = document.getElementById('deleteVerifyAdult').value;
            document.getElementById('deleteVerifyAdult').value = '';

            if (parseInt(userAnswer) === correctAnswer) {
                const newPin = document.getElementById('forgotPinInput').value;
                if (newPin && newPin.length <= 6) {
                    localStorage.setItem('pin', newPin);
                    notification("Pincode is ingesteld - " + newPin);
                    updatePinVisibility();
                    generateNewQuestion();
                    document.getElementById('forgotPinInput').value = '';
                } else {
                    notification('De pincode moet maximaal 6 cijfers bevatten.');
                }
            } else {
                notification('Je hebt een fout antwoord. Probeer het opnieuw.');
                generateNewQuestion();
            }
        }

        function generateNewQuestion() {
            num1 = Math.floor(Math.random() * 7) + 4;
            num2 = Math.floor(Math.random() * 7) + 4;
            correctAnswer = num1 * num2;
            document.getElementById('deleteVerifyAdult').placeholder = `${num1} x ${num2} = ?`;
        }

        function deletePictos() {
            const pin = localStorage.getItem('pin');
            const enteredPin = document.getElementById('deletePictosVerify').value;

            if (!pin) {
                localStorage.removeItem('pictos');
                notification("Alle picto's zijn verwijderd.");
                loadPictosFromLocalStorage();
                return
            }

            if (enteredPin === pin) {
                localStorage.removeItem('pictos');
                notification("Alle picto's zijn verwijderd.");
                loadPictosFromLocalStorage();
                document.getElementById('deletePictosVerify').value = '';
            } else {
                notification("De ingevoerde pincode is onjuist.");
            }

        }

        updatePinVisibility();

        /* SETUP PLANNER SCRIPT */
        checkLocalStorage();
        function checkLocalStorage() {
            if (!localStorage.getItem('plannerSetupComplete')) {
                showSetupMenu();
            } else {
                loadPlanner();
            }
        }

        function showSetupMenu() {
            const setupMenu = document.getElementById('setup-menu');
            setupMenu.style.display = 'block';

            setTimeout(() => {
                setupMenu.classList.add('fade-in');
            }, 10);
        }

        function hideSetupMenu() {
            const setupMenu = document.getElementById('setup-menu');
            setupMenu.classList.remove('fade-in');

            setTimeout(() => {
                setupMenu.style.display = 'none';
            }, 500);
        }

        function createPin() {
            const pinOrNot = document.getElementById('pinOrNot')
            const pinSetup = document.getElementById('pinSetup')

            pinOrNot.style.display = "none";
            pinSetup.style.display = "block";
        }

        function setPin() {
            const pin = document.getElementById('pincode').value;
            if (pin.length <= 6) {
                localStorage.setItem('pin', pin);
                notification("Pincode is opgeslagen - " + pin);
            } else {
                notification('De nieuwe pincode moet maximaal 6 cijfers bevatten.');
            }
        }

        function setupCompleted() {
            localStorage.setItem('plannerSetupComplete', true);
            hideSetupMenu();
            loadPlanner();
        }
    </script>
</body>

</html>