<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muislocatie delen</title>
    <style>
        #map {
            width: 500px;
            height: 500px;
            border: 1px solid #000;
            position: relative;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: absolute;
        }
    </style>
</head>

<body>

    <div id="map"></div>

    <!-- Firebase scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database-compat.js"></script>

    <!-- Your Firebase configuration -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD4FPmA8qPXMowFkdBdTi_Ifp7OM04z-qo",
            databaseURL: "https://testing-5aca1-default-rtdb.europe-west1.firebasedatabase.app/",
            authDomain: "testing-5aca1.firebaseapp.com",
            projectId: "testing-5aca1",
            storageBucket: "testing-5aca1.appspot.com",
            messagingSenderId: "90770517575",
            appId: "1:90770517575:web:8f23d5180a6d69ffa48b62"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const map = document.getElementById('map');
        const body = document.body;

        const colors = ['red', 'blue', 'green', 'yellow', 'orange']; // Array of colors

        const getRandomColor = () => {
            return colors[Math.floor(Math.random() * colors.length)]; // Get a random color from the array
        };

        const userId = Math.random().toString(36).substr(2, 9); // Generate a random user ID

        // Function to remove user position when user leaves
        const removeUserPosition = () => {
            database.ref(`mouse/${userId}`).remove();
        };

        body.addEventListener('mousemove', (e) => {
            const dot = document.querySelector(`.${userId}`); // Select dot based on user ID
            if (!dot) { // If dot doesn't exist, create it
                const newDot = document.createElement('div');
                newDot.classList.add('dot', userId); // Add user ID as class to dot
                newDot.style.backgroundColor = getRandomColor(); // Set random color
                map.appendChild(newDot);
            }

            const x = e.pageX - map.offsetLeft;
            const y = e.pageY - map.offsetTop;

            dot.style.left = `${x}px`;
            dot.style.top = `${y}px`;

            const pos = {
                x: x,
                y: y,
            };
            database.ref(`mouse/${userId}`).set(pos); // Store position in Firebase with user ID

            // Set up removal of user position when user leaves
            window.addEventListener('beforeunload', removeUserPosition);
        });

        // Listen for changes in mouse position from other users
        database.ref('mouse').on('child_changed', (snapshot) => {
            const userId = snapshot.key;
            const position = snapshot.val();
            if (!position) return; // If no position, return

            let dot = document.querySelector(`.${userId}`);
            if (!dot) { // If dot doesn't exist, create it
                dot = document.createElement('div');
                dot.classList.add('dot', userId); // Add user ID as class to dot
                dot.style.backgroundColor = getRandomColor(); // Set random color
                map.appendChild(dot);
            }

            dot.style.left = `${position.x}px`;
            dot.style.top = `${position.y}px`;
        });

        // Remove user position when user leaves
        window.addEventListener('beforeunload', removeUserPosition);

        // Listen for disconnect event
        database.ref(`mouse/${userId}`).onDisconnect().remove();
    </script>
</body>

</html>
