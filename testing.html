<!DOCTYPE html>
<html lang="en">

<head>
    <title>Installation Prompt Demo</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://tctam.nl/style.css">
    <script>
        window.addEventListener("DOMContentLoaded", async event => {
            if ('BeforeInstallPromptEvent' in window) {
                showResult("Hey, wil jij nou de TC_tam app downloaden? Het kost je maar 10 seconden!");
            } else {
                showResult("Sorry, maar jij kan de TC_tam app niet downloaden met deze browser.");
            }
            document.querySelector("#install").addEventListener("click", installApp);

            // Controleer of de app al is geÃ¯nstalleerd en verberg de tekst en knop indien nodig
            if (await isAppInstalled()) {
                hideInstallButton();
            }
        });

        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.querySelector("#install").style.display = "block";
            document.querySelector("#install").style.margin = "0 auto";
        });

        window.addEventListener('appinstalled', (e) => {
            showResult("âœ… AppInstalled fired");
            // Verberg de tekst en knop na installatie
            hideInstallButton();
        });

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                showResult("ðŸ†— Installation Dialog opened");
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                if (outcome === 'accepted') {
                    showResult('Nice, veel plezier met de TC_tam app!');
                    document.querySelector("#install").style.display="none";
                } else if (outcome === 'dismissed') {
                    showResult('Jammer, ik hoop dat je hem de volgende keer wel zal installeren.');
                }
            }
        }

        async function isAppInstalled() {
            // Gebruik getInstalledRelatedApps om te controleren of de app is geÃ¯nstalleerd
            const relatedApps = await navigator.getInstalledRelatedApps();
            return relatedApps.length > 0;
        }

        function showResult(message) {
            const installText = document.querySelector("#install-text");
            installText.textContent = message;
        }

        function hideInstallButton() {
            // Verberg de tekst en knop
            document.querySelector("#install-text").style.display = "none";
            document.querySelector("#install").style.display = "none";
        }
    </script>
    <link rel="manifest" href="https://tctam.nl/app.webmanifest">
</head>

<body>
    <p id="install-text"></p>
    <button id="install">Installeer de TC_tam app</button>
</body>

</html>
