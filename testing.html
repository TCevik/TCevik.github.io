<!DOCTYPE html>
<html>
<head>
    <title>USB Apparaten Koppelen</title>
</head>
<body>
    <h1>USB Apparaten Koppelen</h1>
    <button id="connectButton">Verbinden met USB Apparaat</button>
    <button id="sendIrButton" disabled>Verstuur IR Signaal</button>
    <p id="status"></p>

    <script>
        let device;

        document.getElementById('connectButton').addEventListener('click', async () => {
            try {
                // Vraag de gebruiker om een USB-apparaat te selecteren.
                device = await navigator.usb.requestDevice({ filters: [{}] });

                // Verbind met het geselecteerde apparaat.
                await device.open();

                // Voeg hier de communicatie met het apparaat toe (configuratie, interfaces etc.).
                // Voor nu gaan we ervan uit dat het apparaat direct bruikbaar is.
                await device.selectConfiguration(1);
                
                // Update de status.
                document.getElementById('status').textContent = `Verbonden met apparaat: ${device.productName}`;

                // Schakel de IR-knop in na succesvolle verbinding.
                document.getElementById('sendIrButton').disabled = false;
            } catch (error) {
                document.getElementById('status').textContent = `Fout bij verbinden: ${error}`;
            }
        });

        document.getElementById('sendIrButton').addEventListener('click', async () => {
            try {
                if (device) {
                    // Hier versturen we een voorbeeld IR-commando naar het apparaat.
                    // Het daadwerkelijke commando moet worden aangepast aan je apparaat.
                    const encoder = new TextEncoder();
                    const data = encoder.encode("IR_SIGNaal_HIER"); // Verander dit naar het juiste IR-commando.

                    // Claim de interface voordat we het IR-signaal versturen.
                    await device.claimInterface(0);

                    // Selecteer de juiste alternatieve interface.
                    await device.selectAlternateInterface(0, 0);

                    // Vind het juiste eindpunt voor het IR-signaal.
                    const endpoint = device.configuration.interfaces[0].alternate.endpoints.find(endpoint => endpoint.direction === "out");

                    if (endpoint) {
                        // Verstuur het IR-signaal via het gevonden eindpunt.
                        await device.transferOut(endpoint.endpointNumber, data);
                        document.getElementById('status').textContent = "IR signaal verstuurd!";
                    } else {
                        document.getElementById('status').textContent = "Kan geen uitgaand eindpunt vinden voor IR-signaal.";
                    }
                } else {
                    document.getElementById('status').textContent = "Geen apparaat verbonden.";
                }
            } catch (error) {
                document.getElementById('status').textContent = `Fout bij versturen IR signaal: ${error}`;
            }
        });
    </script>
</body>
</html>
