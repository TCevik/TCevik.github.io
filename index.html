<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TC_tam Homepage</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/script.js"></script>

</head>

<body>
    <nav id="nav_main">
        <div id="nav_logo_container">
            <img id="nav_menu_icon" src="assets/menu-icon.svg" alt="Menu Icon">
            <div id="nav_logo"><a href="#">TC_tam</a></div>
        </div>
        <div id="nav_quickbuttons">
            <a href="#settings"><img src="assets/settings-icon.svg" id="nav_settings_icon" alt="Settings Icon"></a>
        </div>
    </nav>

    <div id="sidebar_main">
        <a href="/index">Home</a>
        <a href="#">About</a>
        <a href="#">Services</a>
        <a href="#">Contact</a>
        <a id="sidebar_copyright">TC_tam &copy; 2023 - <span id="sidebar_copyright_year"></span></a>
    </div>

    <main>
        <h1>Click on the button to go to the site!</h1>
        <button onclick="location.href='https://tctam-site-oud.github.io/';">Go to the temporary site</button>
    </main>

    <script>
document.getElementById("sidebar_copyright_year").textContent = new Date().getFullYear();

const sidebar = document.getElementById("sidebar_main");
const openBtn = document.getElementById("nav_menu_icon");

let sidebarMaxWidth = window.innerWidth <= 496
    ? window.innerWidth - 32
    : parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-width'), 10);

function openNav() {
    sidebar.style.width = sidebarMaxWidth + "px";
}

function closeNav() {
    sidebar.style.width = "0";
}

function toggleNav() {
    const sidebarWidth = parseInt(getComputedStyle(sidebar).width, 10);
    if (sidebarWidth > 0) {
        closeNav();
    } else {
        openNav();
    }
}

openBtn.addEventListener("click", toggleNav);

// Close sidebar on outside click
document.addEventListener("click", function (event) {
    const isClickInside = sidebar.contains(event.target) || openBtn.contains(event.target);
    const sidebarWidth = parseInt(getComputedStyle(sidebar).width, 10);
    if (!isClickInside && sidebarWidth > 0) {
        closeNav();
    }
});

// --- Touch swipe to drag sidebar ---
let touchStartX = 0;
let touchStartY = 0;
let touchStartTime = 0;
let currentSidebarWidth = 0;
let isDragging = false;

document.addEventListener("touchstart", (e) => {
    touchStartX = e.changedTouches[0].clientX;
    touchStartY = e.changedTouches[0].clientY;
    touchStartTime = Date.now();
    currentSidebarWidth = parseInt(getComputedStyle(sidebar).width, 10);
    isDragging = false;

    // Zet transition tijdelijk uit zodat het meebeweegt
    sidebar.style.transition = "none";
}, false);

document.addEventListener("touchmove", (e) => {
    const touchX = e.changedTouches[0].clientX;
    const touchY = e.changedTouches[0].clientY;
    const deltaX = touchX - touchStartX;
    const deltaY = touchY - touchStartY;

    // Check of we horizontaal swipen
    if (!isDragging) {
        if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 5) {
            isDragging = true;
        } else {
            return;
        }
    }

    let newWidth = currentSidebarWidth + deltaX;
    if (newWidth < 0) newWidth = 0;
    if (newWidth > sidebarMaxWidth) newWidth = sidebarMaxWidth;

    sidebar.style.width = newWidth + "px";
}, false);

document.addEventListener("touchend", (e) => {
    sidebar.style.transition = "width 0.5s ease";

    const finalWidth = parseInt(getComputedStyle(sidebar).width, 10);
    const deltaX = e.changedTouches[0].clientX - touchStartX;
    const deltaTime = Date.now() - touchStartTime;
    const swipeSpeed = deltaX / deltaTime; // pixels per ms

    const fastSwipeThreshold = 0.5; // aanpasbaar

    // Beslis open/dicht op basis van fast swipe of halve breedte
    if (swipeSpeed < -fastSwipeThreshold) { 
        // snelle swipe naar links → dicht
        closeNav();
    } else if (swipeSpeed > fastSwipeThreshold) {
        // snelle swipe naar rechts → open
        openNav();
    } else {
        // normale swipe → check halve breedte
        if (finalWidth < sidebarMaxWidth / 2) {
            closeNav();
        } else {
            openNav();
        }
    }
}, false);

// Update sidebar width op resize
window.addEventListener("resize", () => {
    sidebarMaxWidth = window.innerWidth <= 496
        ? window.innerWidth - 32
        : parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-width'), 10);
});

    </script>
</body>

</html>
