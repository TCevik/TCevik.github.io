<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TC_tam Picto Planner</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/script.js"></script>

    <style>
        #planner-container {
            display: none;
        }

        .setup-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            width: 80%;
            height: 80%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--bg-accent-color2), var(--bg-accent-color1));
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 5;
            border-radius: var(--border-radius2);
            overflow-y: auto;
        }

        .settings-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            width: 80%;
            height: 80%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--bg-accent-color2), var(--bg-accent-color1));
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 5;
            border-radius: var(--border-radius2);
            text-align: left;
            align-content: left;
            justify-content: left;
            overflow-y: auto;
        }

        .setup-menu button {
            flex: 1;
            height: 100%;
        }

        #setupButtons {
            display: flex;
        }

        .no-arrows::-webkit-inner-spin-button,
        .no-arrows::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        #planner-content {
            border-radius: var(--border-radius2);
            padding: 15px;
            margin: 25px;
        }

        .picto {
            width: 125px;
            height: 125px;
            border: 1px var(--text-color) solid;
            padding: 5px;
            margin-left: 5px;
            margin-right: 5px;
            user-select: none;
        }

        .settings-menu input {
            margin-left: 0px;
            margin-top: 5px;
            margin-right: 5px;
        }

        #done-editing-button {
            display: none;
        }

        @media (orientation: portrait) {
            .setup-menu {
                width: 85%;
                height: 93%;
                display: none;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            .setup-menu button {
                display: block;
                margin: 10px 0;
                width: 100%;
            }

            .settings-menu {
                width: 85%;
                height: 93%;
                display: none;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            #setupButtons {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }
        }

        @media (max-width: 1299px) {
            #edit-pictos {
                background: linear-gradient(135deg, var(--bg-accent-color2), var(--bg-accent-color1));
                display: none;
                align-content: left;
                text-align: left;
                justify-content: left;
                box-shadow: 0px 0px 10px var(--h1234-color);
                border-radius: var(--border-radius3);
                padding-top: 10px;
                padding-left: 20px;
                padding-right: 20px;
            }

            #planner-container.visible {
                display: block;
            }
        }

        @media (min-width: 1300px) {
            #edit-pictos {
                background: linear-gradient(135deg, var(--bg-accent-color2), var(--bg-accent-color1));
                display: none;
                align-content: left;
                text-align: left;
                justify-content: left;
                position: fixed;
                right: 20px;
                top: 20px;
                bottom: 20px;
                border-left: 0px var(--h1234-color) solid;
                border-radius: var(--border-radius3);
                padding: 25px;
                background-color: var(--bg-accent-color2);
                min-width: 620px;
                max-width: 620px;
                width: auto;
                overflow-y: scroll;
                box-shadow: 0px 0px 10px var(--h1234-color);
            }

            #planner-container.visible {
                display: flex;
            }

            #edit-pictos .picto {
                width: 100px;
                height: 100px;
            }

            #left-side {
                width: 100%;
            }

            #left-side.editing {
                width: calc(100% - 670px);
            }
        }

        #edit-pictos::-webkit-scrollbar {
            display: none;
        }

        .perm-picto {
            margin: 3px;
        }
    </style>
</head>

<body>
    <div id="setup-menu" class="setup-menu">
        <h2>Laten we de planner instellen.</h2>
        <div id="pinOrNot">
            <h4>Wil je een pincode instellen?</h4>
            <p style="margin: 5px;">Een pincode zorgt ervoor dat je kind de planning niet zomaar kan veranderen.</p>
            <div id="setupButtons">
                <button onclick="setupCreatePin()">Ja, stel een code in!</button>
                <button onclick="setupCompleted()">Nee, ga verder zonder code!</button>
            </div>
        </div>

        <div id="pinSetup" style="display:none;">
            <h4>Voer een pincode in:</h4>
            <input autocomplete="off" type="text" id="pincode" placeholder="Pincode" maxlength="6"
                oninput="this.value = this.value.replace(/[^0-9]/g, '');" class="no-arrows">
            <button onclick="pincode('set', 'setup', document.getElementById('pincode').value)">Pincode
                instellen</button>
        </div>
    </div>

    <div id="settings-menu" class="settings-menu">
        <button onclick="toggleSettings()">Sluiten</button>
    </div>

    <div id="planner-container">
        <div id="left-side">
            <h1 id="title" style="margin-bottom: -10px; margin-top: 60px;">TC_tam Picto Planner</h1>
            <h4 style="font-size: 1em;">Pictogrammen geleverd door sclera.be</h4>

            <div id="planner-content"></div>
        </div>

        <div id="edit-pictos">
            <div style="display: flex;">
                <button onclick="removePlanning()" style="flex: 1; border: none; background-color: red;">Verwijder de
                    planning</button>
                <button onclick="removeUploaded()" style="flex: 1; border: none; background-color: red;">Verwijder
                    ge√ºploade picto's</button>
            </div>
            <br>

            <h3>Dagen van de week:</h3>
            <img class="picto perm-picto" src="/picto-planner/dagen/maandag.png" title="Maandag">
            <img class="picto perm-picto" src="/picto-planner/dagen/dinsdag.png" title="Dinsdag">
            <img class="picto perm-picto" src="/picto-planner/dagen/woensdag.png" title="Woensdag">
            <img class="picto perm-picto" src="/picto-planner/dagen/donderdag.png" title="Donderdag">
            <img class="picto perm-picto" src="/picto-planner/dagen/vrijdag.png" title="Vrijdag">
            <img class="picto perm-picto" src="/picto-planner/dagen/zaterdag.png" title="Zaterdag">
            <img class="picto perm-picto" src="/picto-planner/dagen/zondag.png" title="Zondag">

            <h3>Speciale activiteiten:</h3>
            <img class="picto perm-picto" src="/picto-planner/speciale-activiteiten/verjaardag.png" title="Koningsdag">
            <img class="picto perm-picto" src="/picto-planner/speciale-activiteiten/pasen.png" title="Pasen">
            <img class="picto perm-picto" src="/picto-planner/speciale-activiteiten/samen-vieren.png"
                title="Verjaardag">
            <img class="picto perm-picto" src="/picto-planner/speciale-activiteiten/vuurwerk.png" title="Oud en nieuw">
            <img class="picto perm-picto" src="/picto-planner/speciale-activiteiten/geschenk.png" title="Cadeautje">
            <img class="picto perm-picto" src="/picto-planner/speciale-activiteiten/sinterklaas.png"
                title="Sinterklaas">
            <img class="picto perm-picto" src="/picto-planner/speciale-activiteiten/schoen-zetten.png"
                title="Schoen zetten">
            <img class="picto perm-picto" src="/picto-planner/speciale-activiteiten/kerstmis.png" title="Kerst">
            <img class="picto perm-picto" src="/picto-planner/speciale-activiteiten/bungalow.png"
                title="Vakantiehuisje">
            <img class="picto perm-picto" src="/picto-planner/speciale-activiteiten/halloween.png" title="Halloween">

            <h3>Verzorging:</h3>
            <img class="picto perm-picto" src="/picto-planner/verzorging/nagel-knippen.png" title="Nagels knippen">
            <img class="picto perm-picto" src="/picto-planner/verzorging/kapper.png" title="Haren knippen">
            <img class="picto perm-picto" src="/picto-planner/verzorging/tanden-poetsen.png" title="Tanden poetsen">
            <img class="picto perm-picto" src="/picto-planner/verzorging/gel-haar.png" title="Haren doen">
            <img class="picto perm-picto" src="/picto-planner/verzorging/handen-wassen.png" title="Handen wassen">
            <img class="picto perm-picto" src="/picto-planner/verzorging/spuit.png" title="Prik">
            <img class="picto perm-picto" src="/picto-planner/verzorging/voeten-wassen.png" title="Voeten wassen">

            <h3>Buitenactiviteiten:</h3>
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/park.png" title="Naar het park">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/winkelen.png"
                title="Naar de winkel">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/ziekenhuis.png"
                title="Naar het ziekenhuis">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/apotheek.png"
                title="Naar de apotheek">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/markt.png" title="Naar de markt">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/museum.png"
                title="Naar het museum">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/bakker.png"
                title="Naar de bakker">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/vliegveld.png"
                title="Naar het vliegveld">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/restaurant.png"
                title="Maar het restaurant">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/fitness-center.png"
                title="Naar de sportschool">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/boerderij.png"
                title="Naar de boederij">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/speeltuin.png"
                title="Naar de speeltuin">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/wasstraat.png"
                title="Naar de wasstraat">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/brievenbus.png"
                title="Post versturen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/huis.png" title="Naar huis">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/strand.png"
                title="Naar het strand">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/kermis.png"
                title="Naar de kermis">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/zwemmen.png"
                title="Naar het zwembad">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/picnic.png" title="Picknicken">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/school.png" title="Naar school">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/wandelen.png" title="Wandelen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/kledingwinkel.png"
                title="Naar de kledingwinkel">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/cinema.png"
                title="Naar de bioscoop">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-buitenhuis/buitenspelen.jpg"
                title="Buitenspelen">

            <h3>Binnenactiviteiten:</h3>
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/computer-alleen.png"
                title="Alleen gamen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/computer-samen.png"
                title="Samen gamen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/spelen-alleen.png"
                title="Alleen spelen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/spelen-samen.png"
                title="Samen spelen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/fruit.png" title="Fruit eten">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/ontbijt.png" title="Ontbijt">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/middagmaal.png" title="Lunch">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/avondmaal.png" title="Avondeten">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/opstaan.png" title="Opstaan">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/slapen.jpg" title="Slapen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/tablet.png"
                title="Spelen op de tablet ">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/pictogrammen.png"
                title="Picto's klaarmaken">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/koken.png" title="Koken">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/bureauwerk.png" title="Studeren">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/tv.png" title="TV kijken">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/tekenen.png" title="Tekenen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/tussendoortje.png"
                title="Tussendoortje">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/bad.png" title="Douchen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/zwijgen.png" title="Stil zijn">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/huiswerk-stil.png"
                title="Stil werken">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/timetimer.png" title="Time timer">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/opruimen.png" title="Opruimen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/schoonmaken.png"
                title="Schoonmaken">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/barbeque.png" title="Barbecue√´n">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/boek.png" title="Boekje lezen">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/rugzak-inpakken.png"
                title="Tas inpakken">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/klok.png" title="Klok">
            <img class="picto perm-picto" src="/picto-planner/activiteiten-binnenhuis/gym.png" title="Gymmen">

            <h3>Vervoer:</h3>
            <img class="picto perm-picto" src="/picto-planner/vervoer/taxi.png" title="Taxi">
            <img class="picto perm-picto" src="/picto-planner/vervoer/auto.png" title="Auto">
            <img class="picto perm-picto" src="/picto-planner/vervoer/tandem.png" title="Tandem">
            <img class="picto perm-picto" src="/picto-planner/vervoer/treinstation.png" title="Station">
            <img class="picto perm-picto" src="/picto-planner/vervoer/trein.png" title="Trein">
            <img class="picto perm-picto" src="/picto-planner/vervoer/metro.png" title="Metro">
            <img class="picto perm-picto" src="/picto-planner/vervoer/tram.png" title="Tram">
            <img class="picto perm-picto" src="/picto-planner/vervoer/vliegtuig.png" title="Vliegtuig">
            <img class="picto perm-picto" src="/picto-planner/vervoer/motor.png" title="Motor">
            <img class="picto perm-picto" src="/picto-planner/vervoer/boot.png" title="Boot">
            <img class="picto perm-picto" src="/picto-planner/vervoer/ov.png" title="Openbaar vervoer">
            <img class="picto perm-picto" src="/picto-planner/vervoer/ov-chipkaart.png" title="OV-chipkaart">

            <h3>Ge√ºploade picto's</h3>
            <button style="margin-bottom: 5px;" id="upload-picto-button">Upload een picto</button>
            <input type="file" id="upload-picto-input" accept="image/*" multiple style="display: none;" />
            <div id="uploaded-pictos"></div>
        </div>

        <button id="settings-button" style="position: fixed; top: 5px; left: 5px;"
            onclick="toggleSettings()">Instellingen</button>

        <button id="edit-button" style="position: fixed; top: 5px; right: 5px;" onclick="editPlanner()">Planner
            aanpassen</button>
        <button id="done-editing-button" style="position: fixed; top: 5px; right: 5px;"
            onclick="doneEditingPlanner()">Klaar</button>
    </div>

    <script>
        const plannerContent = document.getElementById('planner-content');
        const pictos = document.querySelectorAll('#edit-pictos .picto');

        const dbName = 'PictoPlannerDB';
        const storeName = 'pictos';
        const uploadedStoreName = 'uploadedPictos';
        let db;

        const openDatabase = () => {
            const request = indexedDB.open(dbName, 1);

            request.onupgradeneeded = (event) => {
                db = event.target.result;
                db.createObjectStore(storeName, { keyPath: 'id' });
                db.createObjectStore(uploadedStoreName, { keyPath: 'id' });
                console.log("Database ge√ºpgraded en stores aangemaakt");
            };

            request.onsuccess = (event) => {
                db = event.target.result;
                console.log("Database geopend:", dbName);
                loadPictos();
                loadUploadedPictos();
            };

            request.onerror = (event) => {
                console.error('Database fout:', event.target.error);
            };
        };

        const removePlanning = () => {
            if (confirm('Weet je zeker dat je alle picto\'s uit de planning wilt verwijderen?')) {
                const transaction = db.transaction(storeName, 'readwrite');
                const objectStore = transaction.objectStore(storeName);

                const request = objectStore.getAll();
                request.onsuccess = (event) => {
                    const pictos = event.target.result;
                    pictos.forEach(picto => {
                        objectStore.delete(picto.id);
                        const pictoElement = plannerContent.querySelector(`img[data-id='${picto.id}']`);
                        if (pictoElement) {
                            plannerContent.removeChild(pictoElement);
                        }
                    });
                    notification('Alle picto\'s uit de planning zijn verwijderd.');
                };

                request.onerror = (event) => {
                    notification('Fout bij ophalen pictos voor verwijderen:' + event.target.error);
                };
            }
        };

        const removeUploaded = () => {
            if (confirm('Weet je zeker dat je alle ge√ºploade picto\'s wilt verwijderen?')) {
                const transaction = db.transaction(uploadedStoreName, 'readwrite');
                const objectStore = transaction.objectStore(uploadedStoreName);

                const request = objectStore.getAll();
                request.onsuccess = (event) => {
                    const pictos = event.target.result;
                    pictos.forEach(picto => {
                        objectStore.delete(picto.id);
                        const pictoElement = document.querySelector(`#uploaded-pictos img[data-id='${picto.id}']`);
                        if (pictoElement) {
                            const pictoContainer = pictoElement.parentElement;
                            document.getElementById('uploaded-pictos').removeChild(pictoContainer);
                        }
                    });
                    notification('Alle ge√ºploade picto\'s zijn verwijderd.');
                };

                request.onerror = (event) => {
                    notification('Fout bij ophalen ge√ºploade pictos voor verwijderen:' + event.target.error);
                };
            }
        };
        
        const savePicto = (pictoSrc, pictoTitle, store) => {
            const transaction = db.transaction([store], 'readwrite');
            const objectStore = transaction.objectStore(store);

            const picto = { id: Date.now(), src: pictoSrc, title: pictoTitle };
            const request = objectStore.add(picto);

            request.onsuccess = () => {
                console.log('Picto opgeslagen:', picto);
                if (store === uploadedStoreName) {
                    addUploadedPictoToEditSection(pictoSrc, pictoTitle, picto.id);
                } else if (store === storeName) {
                    addPictoToPlanner(pictoSrc, pictoTitle, picto.id);
                }
            };

            request.onerror = (event) => {
                console.error('Fout bij opslaan:', event.target.error);
            };
        };

        const loadPictos = () => {
            const transaction = db.transaction([storeName], 'readonly');
            const objectStore = transaction.objectStore(storeName);
            const request = objectStore.getAll();

            request.onsuccess = (event) => {
                const pictos = event.target.result;
                pictos.forEach(picto => {
                    addPictoToPlanner(picto.src, picto.title, picto.id);
                });
            };

            request.onerror = (event) => {
                console.error('Fout bij ophalen:', event.target.error);
            };
        };

        const loadUploadedPictos = () => {
            const transaction = db.transaction([uploadedStoreName], 'readonly');
            const objectStore = transaction.objectStore(uploadedStoreName);
            const request = objectStore.getAll();

            request.onsuccess = (event) => {
                const pictos = event.target.result;
                pictos.forEach(picto => {
                    addUploadedPictoToEditSection(picto.src, picto.title, picto.id);
                });
            };

            request.onerror = (event) => {
                console.error('Fout bij ophalen ge√ºploade pictos:', event.target.error);
            };
        };

        const addPictoToPlanner = (src, title, id) => {
            const newPicto = document.createElement('img');
            newPicto.src = src;
            newPicto.className = 'picto';
            newPicto.title = title;
            newPicto.setAttribute('data-id', id);

            newPicto.addEventListener('click', () => {
                const editButton = document.getElementById('edit-button');
                if (editButton.style.display === 'none') {
                    removePictoFromPlanner(id, newPicto);
                }
            });

            plannerContent.appendChild(newPicto);
        };

        const addUploadedPictoToEditSection = (src, title, id) => {
            const pictoContainer = document.createElement('div');
            pictoContainer.style.position = 'relative';
            pictoContainer.style.display = 'inline-block';

            const newPicto = document.createElement('img');
            newPicto.src = src;
            newPicto.className = 'uploaded-picto picto';
            newPicto.title = title;
            newPicto.setAttribute('data-id', id);

            const removeButton = document.createElement('img');
            removeButton.src = '/assets/close-button.png';
            removeButton.className = 'remove-picto-button';
            removeButton.style.position = 'absolute';
            removeButton.style.top = '3px';
            removeButton.style.right = '7px';
            removeButton.style.color = 'black';
            removeButton.style.backgroundColor = 'red';
            removeButton.style.border = '1px var(--text-color) solid';
            removeButton.style.cursor = 'pointer';
            removeButton.style.borderRadius = '50%';
            removeButton.style.width = '30px';
            removeButton.style.height = '30px';
            removeButton.style.display = 'flex';
            removeButton.style.alignItems = 'center';
            removeButton.style.justifyContent = 'center';
            removeButton.style.zIndex = '1';

            removeButton.addEventListener('click', (event) => {
                event.stopPropagation();
                removeUploadedPicto(id, pictoContainer);
            });

            newPicto.addEventListener('click', () => {
                savePicto(src, title, storeName);
            });

            pictoContainer.appendChild(newPicto);
            pictoContainer.appendChild(removeButton);
            document.getElementById('uploaded-pictos').appendChild(pictoContainer);
        };

        const removeUploadedPicto = (id, pictoElement) => {
            const transaction = db.transaction([uploadedStoreName], 'readwrite');
            const objectStore = transaction.objectStore(uploadedStoreName);

            const request = objectStore.delete(id);

            request.onsuccess = () => {
                console.log('Uploaded Picto verwijderd uit database:', id);
                document.getElementById('uploaded-pictos').removeChild(pictoElement);
            };

            request.onerror = (event) => {
                console.error('Fout bij verwijderen van de uploaded picto:', event.target.error);
            };
        };

        const removePictoFromPlanner = (id, pictoElement) => {
            const transaction = db.transaction([storeName], 'readwrite');
            const objectStore = transaction.objectStore(storeName);

            const request = objectStore.delete(id);

            request.onsuccess = () => {
                console.log('Picto verwijderd uit database:', id);
                plannerContent.removeChild(pictoElement);
            };

            request.onerror = (event) => {
                console.error('Fout bij verwijderen:', event.target.error);
            };
        };

        document.getElementById('upload-picto-button').addEventListener('click', () => {
            document.getElementById('upload-picto-input').click();
        });

        document.getElementById('upload-picto-input').addEventListener('change', (event) => {
            const files = event.target.files;
            if (files.length > 0) {
                const fileArray = Array.from(files);
                processFileQueue(fileArray, files.length);
            }
        });

        function processFileQueue(fileArray, totalFiles) {
            if (fileArray.length === 0) {
                return;
            }

            const file = fileArray.shift();
            const reader = new FileReader();
            const uploadedFiles = totalFiles - fileArray.length;

            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    canvas.width = 300;
                    canvas.height = 300;

                    ctx.drawImage(img, 0, 0, 300, 300);

                    const pictoSrc = canvas.toDataURL('image/jpeg');
                    const pictoTitle = file.name;

                    savePicto(pictoSrc, pictoTitle, uploadedStoreName);

                    const progressPercentage = Math.round((uploadedFiles / totalFiles) * 100);
                    notification(`Upload progress: ${progressPercentage}%`);

                    adjustTimeout(() => {
                        processFileQueue(fileArray, totalFiles);
                    });
                };
                img.src = e.target.result;
            };

            reader.readAsDataURL(file);
        }

        function adjustTimeout(callback) {
            const memory = performance.memory;
            const usedJSHeapSize = memory.usedJSHeapSize / memory.jsHeapSizeLimit;

            let delay = 1;

            if (usedJSHeapSize > 0.75) {
                delay = 1000;
            }

            setTimeout(callback, delay);
        }

        pictos.forEach(picto => {
            picto.addEventListener('click', () => {
                const pictoSrc = picto.src;
                const pictoTitle = picto.title;

                savePicto(pictoSrc, pictoTitle, storeName);
            });
        });

        openDatabase();

        /* PICTO PLANNER SETUP SCRIPT */
        function loadPlanner() {
            document.getElementById('planner-container').classList.add('visible');
            const pin = localStorage.getItem('pictoPlannerPin');
            if (!pin) {
                editPlanner();
            }
        }

        function editPlanner() {
            const storedPin = localStorage.getItem('pictoPlannerPin');
            if (storedPin) {
                const pin = prompt("Voer je pincode in:");
                if (pin === storedPin) {
                    document.getElementById('edit-button').style.display = 'none';
                    document.getElementById('edit-pictos').style.display = 'block';
                    document.getElementById('done-editing-button').style.display = 'block';
                } else {
                    notification("Ongeldige pincode. Probeer het opnieuw.");
                }
            } else {
                document.getElementById('edit-button').style.display = 'none';
                document.getElementById('edit-pictos').style.display = 'block';
                document.getElementById('done-editing-button').style.display = 'block';
            }

            const editButton = document.getElementById('edit-button');
            const leftSide = document.getElementById('left-side');

            if (editButton.style.display === 'none') {
                leftSide.classList.add('editing');
            } else {
                leftSide.classList.remove('editing');
            }
        }

        function doneEditingPlanner() {
            document.getElementById('edit-button').style.display = 'block';
            document.getElementById('edit-pictos').style.display = 'none';
            document.getElementById('done-editing-button').style.display = 'none';

            const editButton = document.getElementById('edit-button');
            const leftSide = document.getElementById('left-side');

            if (editButton.style.display === 'none') {
                leftSide.classList.add('editing');
            } else {
                leftSide.classList.remove('editing');
            }
        }

        /* SETTINGS MENU SCRIPT */
        function toggleSettings() {
            const settingsMenu = document.getElementById('settings-menu');
            const isMenuOpen = settingsMenu.style.display === 'block';

            if (isMenuOpen) {
                settingsMenu.style.display = 'none';
                document.getElementById('settings-button').style.display = "block";
                document.getElementById('done-editing-button').click();

                const pin = localStorage.getItem('pictoPlannerPin');
                if (pin) {
                    document.getElementById('edit-button').style.display = 'block';
                }
            } else {
                settingsMenu.style.display = 'block';
                document.getElementById('done-editing-button').click();
                document.getElementById('edit-button').style.display = "none";
                document.getElementById('settings-button').style.display = "none";
            }
        }

        /* SETUP PLANNER SCRIPT */
        checkLocalStorage();
        function checkLocalStorage() {
            if (!localStorage.getItem('plannerSetupComplete')) {
                showSetupMenu();
            } else {
                loadPlanner();
            }
        }

        function showSetupMenu() {
            const setupMenu = document.getElementById('setup-menu');
            setupMenu.style.display = 'block';
        }

        function hideSetupMenu() {
            const setupMenu = document.getElementById('setup-menu');
            setupMenu.style.display = 'none';
        }

        function setupCreatePin() {
            document.getElementById('pinOrNot').style.display = 'none';
            document.getElementById('pinSetup').style.display = 'block';
        }

        function pincode(action, phase, pincode) {
            if (action === 'set') {
                if (pincode.length >= 3) {
                    if (pincode.length <= 6) {
                        localStorage.setItem('pictoPlannerPin', pincode);
                        notification("Je pincode is opgeslagen - " + pincode);

                        if (phase === 'setup') {
                            setupCompleted();
                        }

                        if (phase === 'settings') {
                            return;
                        }
                    } else {
                        notification('De pincode mag maximaal 6 cijfers bevatten.');
                    }
                } else {
                    notification('De pincode moet minimaal 3 cijfers bevatten.');
                }
            }
        }

        function setupCompleted() {
            localStorage.setItem('plannerSetupComplete', true);
            hideSetupMenu();
            loadPlanner();
        }
    </script>
</body>

</html>