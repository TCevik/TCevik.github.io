<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <title>TC_tam Online Store</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/script.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-remote-config.js"></script>
    <script src="/account/config.js"></script>

    <style>
        #products {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .product {
            display: flex;
            justify-content: center;
            flex-direction: column;
            margin-top: 20px;
            max-width: 250px;
            max-height: 500px;
            text-align: left;
            border: 1px var(--text-color) solid;
            border-radius: var(--border-radius2);
            padding: 20px;
            margin: 15px;
        }

        .product-preview {
            align-self: center;
            width: 200px;
            height: 200px;
            margin: 3px;
        }

        .product-title {
            margin-top: 5px;
            margin-bottom: -15px;
            font-weight: 600;
        }

        .product-description {
            filter: brightness(0.8);
            overflow-y: auto;
        }

        .product-price {
            color: var(--h1234-color);
            margin-top: -10px;
        }

        .buy-button {
            margin-left: 15px;
        }

        a {
            border-bottom: none !important;
        }

        #search-bar {
            width: 100%;
            max-width: 500px;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: var(--border-radius2);
        }

        #no-results {
            display: none;
            text-align: center;
            color: red;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let products = [];

            const remoteConfig = firebase.remoteConfig();
            const remoteConfigSettings = {
                minimumFetchIntervalMillis: 100,
            };
            remoteConfig.settings = remoteConfigSettings;

            remoteConfig.fetchAndActivate()
                .then(() => {
                    const productsJson = remoteConfig.getString('producten_online_store');
                    products = JSON.parse(productsJson);
                    renderProducts(products); // Render de producten na het ophalen
                })
                .catch((error) => {
                    notification("Er is een fout opgetreden bij het ophalen van de producten:" + error);
                });

            const searchInput = document.getElementById("search-bar");

            function renderProducts(filteredProducts) {
                const productContainer = document.getElementById("products");
                const noResultsMessage = document.getElementById("no-results");
                productContainer.innerHTML = '';

                if (filteredProducts.length > 0) {
                    noResultsMessage.style.display = 'none';
                    filteredProducts.forEach(product => {
                        productContainer.innerHTML += generateProductHTML(product);
                    });
                } else {
                    noResultsMessage.style.display = 'block';
                }
            }

            function generateProductHTML(product) {
                return `
                    <div class="product">
                        <img class="product-preview" src="${product.image}">
                        <p class="product-title">${product.name}</p>
                        <p class="product-description">${product.description}</p>
                        <p class="product-price">Totaal: ${product.price}
                            <a href="${product.paylink}" target="_blank">
                                <button class="buy-button">Nu kopen</button>
                            </a>
                        </p>
                    </div>
                `;
            }

            function filterProducts(searchTerm) {
                const filteredProducts = products.filter(product => {
                    return (
                        product.name.toLowerCase().includes(searchTerm) ||
                        product.description.toLowerCase().includes(searchTerm) ||
                        product.keywords.some(keyword => keyword.toLowerCase().includes(searchTerm))
                    );
                });
                renderProducts(filteredProducts);
            }

            searchInput.addEventListener("input", function () {
                const searchTerm = searchInput.value.trim().toLowerCase();
                filterProducts(searchTerm);
            });

            function applyHashSearch() {
                if (window.location.hash) {
                    const searchTermEncoded = decodeURIComponent(window.location.hash.substring(1)); // Haal # weg en decodeer
                    const searchTerm = decodeURIComponent(searchTermEncoded); // Decodeer zoekterm
                    searchInput.value = searchTerm;
                    filterProducts(searchTerm);
                }
            }

            window.addEventListener('hashchange', applyHashSearch);

            applyHashSearch();

            // Initieel renderen van alle producten
            renderProducts(products);
        });
    </script>

    <h1>TC_tam Online Store [Vroege toegang]</h1>
    <p>Afrekenen kan niet in de TC_tam app! Doe dat op het web.</p>

    <input type="text" id="search-bar" placeholder="Zoek naar producten...">

    <h3 style="margin-bottom: -10px;">Aanbevolen:</h3>
    <p id="no-results">Oeps, dat hebben we niet kunnen vinden...</p>
    <div id="products">
        <!-- Hier komen de producten. -->
    </div>

    <footer>
        <p style="margin: 0px;">TC_tam Online Storeâ„¢</p>
        <p style="margin: 0px; filter: brightness(0.8);">(Nog) geen retourzendingen!</p>
        <p style="margin: 0px; filter: brightness(0.8);">Ik ben verantwoordelijk voor de verzending van alle producten.
            Nadat u heeft betaald, zal ik het pakket verzenden en ontvangt u daarna een bevestiging per e-mail met de
            huidige status van de pakketbezorging.</p>
    </footer>
</body>

</html>