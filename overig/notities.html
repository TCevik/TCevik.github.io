<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <title>Notitie maker</title>

    <link rel="stylesheet" href="/style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="/script.js"></script>

</head>

<body>

    <h1>Notities</h1>
    <p>Hier kan je notities maken!!!</p>

    <button id="save-button" onclick="saveData()">Opslaan</button>
    <br><textarea id="input" rows="25" style="width: 90%;" maxlength="100000" disabled="true"></textarea>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDp6L5-6r3a6yQV_py46q3GWf_ZL2ttfu8",
            authDomain: "tctam-d04b8.firebaseapp.com",
            projectId: "tctam-d04b8",
            storageBucket: "tctam-d04b8.appspot.com",
            messagingSenderId: "793882705601",
            appId: "1:793882705601:web:118e6ea26069867d0b5e40",
            measurementId: "G-Q00YFYX8SP"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const db = firebase.firestore();
        const auth = firebase.auth();

        function saveData() {
            const user = auth.currentUser;
            if (!user) {
                alert("Je moet ingelogd zijn om notities op te slaan.");
                return;
            }

            if (!user.emailVerified) {
                alert("Je moet je e-mailadres verifiÃ«ren om notities op te slaan.");
                return;
            }

            let userEmail = "Niet_beschikbaar";
            if (user.email !== null) {
                userEmail = user.email
            }

            db.collection('userdata').doc(userEmail).set({
                text: document.getElementById('input').value,
                userEmail: userEmail
            })
            .then(() => {
                alert("Data is succesvol opgeslagen.");
            })
            .catch((error) => {
                alert("Data kon niet worden opgeslagen. Foutmelding: " + error);
            });
        }

        function load() {
            document.getElementById("input").disabled = false;
            const user = auth.currentUser;
            if (user) {
                let userEmail = "Niet_beschikbaar";
                if (user.email !== null) {
                    userEmail = user.email
                }

                db.collection('userdata').doc(userEmail).get()
                .then((doc) => {
                    if (doc.exists) {
                        document.getElementById('input').value = doc.data().text;
                    }
                })
                .catch((error) => {
                    alert("Er is een fout opgetreden bij het ophalen van de gegevens: " + error);
                });
            }
        };

        setTimeout(() => {
            load();
        }, 2000);
    </script>
</body>

</html>